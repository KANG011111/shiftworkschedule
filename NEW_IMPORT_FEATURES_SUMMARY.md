# 班表匯入功能增強摘要

## 🆕 新增功能

### 1. 強制匯入模式
- **功能**：忽略班別驗證，自動建立新班別類型
- **使用場景**：匯入包含系統未知班別的資料
- **介面**：匯入頁面勾選「強制匯入模式」

### 2. 空白班別處理
- **功能**：將空白班別自動處理為「未排班」狀態
- **班別代碼**：`UNASSIGNED`
- **顏色**：灰色 (`#9ca3af`)
- **介面**：匯入頁面勾選「允許空白班別」(預設勾選)

### 3. 複合班別格式支援
- **支援格式**：
  - `P4p/ME` - P4班/ME相關
  - `P1c/工程` - P1班/工程相關
  - `FC/前製` - FC班/前製相關  
  - `P2s/LD` - P2班/LD相關
  - `P3p/Crew` - P3班/Crew相關

### 4. 民國年自動轉換
- **支援格式**：`114/08` 自動轉換為 `2025/08`
- **轉換規則**：民國年 + 1911 = 西元年
- **範圍**：民國10年~200年

### 5. 進階匯入選項
- **合併模式**：保留現有資料，新增或更新排班記錄 (預設)
- **覆蓋模式**：清除現有資料後重新匯入

## 📋 測試檔案格式

你的測試檔案 `testcsv/08n8n.csv` 格式：
```csv
姓名,員工代碼,年月,日期,班別
賴 秉 宏,8652,114/08,1,FX
賴 秉 宏,8652,114/08,2,H0
...
郭 建 中,0190,114/08,1,        (空白班別)
郭 建 中,0190,114/08,2,P1c/工程 (複合班別)
...
```

## 🔧 技術實現

### 後端修改
- `routes.py`: 新增強制匯入參數處理
- `perform_data_import_v11()`: 支援新匯入選項
- `get_shift_info()`: 增強班別資訊解析
- `combine_date_from_5_column()`: 民國年轉換

### 前端修改
- `upload_new.html`: 新增進階選項介面
- 強制匯入選項
- 空白班別處理選項
- 匯入模式選擇 (合併/覆蓋)

## 📊 測試結果

✅ 班別資訊解析測試通過：
- `P4p/ME` → P4p/ME班, 20:00-05:00
- `P1c/工程` → P1c/工程班, 08:00-17:00  
- `FC/前製` → FC班/前製, 09:00-18:00
- `UNASSIGNED` → 未排班, 00:00-00:00

✅ 民國年轉換測試通過：
- `114/08 + 1` → `2025-08-01`
- `114/08 + 15` → `2025-08-15`
- `114/08 + 31` → `2025-08-31`

## 🎯 使用步驟

1. **訪問匯入頁面**：`http://localhost:5001/upload_new`
2. **上傳CSV檔案**：選擇你的 `08n8n.csv` 檔案
3. **選擇群組**：燈光組
4. **配置選項**：
   - ✅ 強制匯入模式 (處理未知班別)
   - ✅ 允許空白班別 (處理部分工時人員)
   - 選擇匯入模式 (合併/覆蓋)
5. **執行匯入**：點擊確認匯入

## 💡 注意事項

- 強制匯入會自動創建新的 ShiftType 記錄
- 空白班別會創建 `UNASSIGNED` 班別類型
- 複合班別保留完整格式（如 `P4p/ME`）
- 民國年會自動轉換為西元年
- 匯入前建議先預覽驗證結果

---
🎉 **新功能已全面就緒，可以處理你的實際班表資料！**